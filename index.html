<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tonayu | Int√©rprete Web</title>
  <link rel="stylesheet" href="css/styles.css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700&family=Roboto&display=swap"
    rel="stylesheet" />
</head>

<!-- Estilos adicionales -->
<style>
  /* Modal base */
  .modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background-color: rgba(0, 77, 64, 0.8);
    /* Color con #004d40 */
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
  }

  /* Contenedor del contenido */
  .modal-contenido {
    background: #ffffff;
    max-height: 90vh;
    overflow-y: auto;
    padding: 24px 32px;
    width: 92%;
    max-width: 960px;
    border-radius: 12px;
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.35);
    position: relative;
    font-family: 'Segoe UI', 'Poppins', sans-serif;
    color: #212121;
  }

  /* Cierre (X) */
  .cerrar {
    position: absolute;
    top: 16px;
    right: 24px;
    font-size: 28px;
    font-weight: bold;
    color: #004d40;
    cursor: pointer;
    transition: color 0.3s ease;
  }

  .cerrar:hover {
    color: #d32f2f;
  }

  /* T√≠tulos */
  .modal-contenido h2,
  .modal-contenido h3 {
    color: #004d40;
    margin-top: 24px;
    border-bottom: 2px solid #004d40;
    padding-bottom: 6px;
  }

  /* Tabla */
  .modal-contenido table {
    width: 100%;
    border-collapse: collapse;
    margin: 16px 0;
    font-size: 15px;
  }

  .modal-contenido table th,
  .modal-contenido table td {
    border: 1px solid #b0bec5;
    padding: 10px 12px;
    text-align: left;
  }

  .modal-contenido table th {
    background-color: #004d40;
    color: white;
  }

  .modal-contenido table tr:nth-child(even) {
    background-color: #e0f2f1;
  }

  .modal-contenido table tr:hover {
    background-color: #b2dfdb;
  }

  /* Responsive */
  @media (max-width: 768px) {
    .modal-contenido {
      padding: 16px;
      width: 96%;
    }

    .modal-contenido table {
      font-size: 14px;
    }

    .cerrar {
      top: 12px;
      right: 16px;
      font-size: 24px;
    }
  }
</style>

<body>
  <header>
    <div class="header-left">
      <img src="sol.png" alt="Logo Tonayu" id="logo">
      <div class="header-texto">
        <h1 data-es="Tonayu: Int√©rprete Web" data-nah="Tonayu: Tlahtolpehpenalistli">Tonayu: Int√©rprete Web</h1>
        <p data-es="Lenguaje ritual inspirado en el n√°huatl. Claro. Funcional. Simb√≥lico."
          data-nah="Tlahtolli tlamanilistli ipan n√°huatl. Tlatzintlan. Tlachihualiz. Tlamachiliz.">
          Lenguaje ritual inspirado en el n√°huatl. Claro. Funcional. Simb√≥lico.
        </p>
      </div>
    </div>

    <div class="header-controls">
      <select id="language-selector">
        <option value="es" selected>Espa√±ol</option>
        <option value="nah">N√°huatl</option>
      </select>
      <button id="ejemplos-btn">üìö Ejemplos</button>
      <button id="btnDiccionario">üìò Diccionario Tonayu</button>
      <button id="manual-btn">üõ† Manual</button>
    </div>
  </header>


  <main>
    <div class="example-selector" id="example-selector" style="display: none;">
      <label for="example-list">Selecciona un ejemplo:</label>
      <select id="example-list">
        <option value="0">-- Elige una opci√≥n --</option>
        <optgroup label="1. Variables y Aritm√©tica">
          <option value="ej1">Declaraci√≥n y operaciones</option>
        </optgroup>
        <optgroup label="2. Funciones y llamadas">
          <option value="ej2">Funci√≥n sumar</option>
          <option value="ej3">Funci√≥n saludar</option>
          <option value="ej4">Funci√≥n con retorno</option>
        </optgroup>
        <optgroup label="3. Condicionales">
          <option value="ej5">Condicional simple</option>
          <option value="ej6">Condicional con else</option>
        </optgroup>
        <optgroup label="4. Ciclos">
          <option value="ej7">Ciclo while (muk)</option>
        </optgroup>
        <optgroup label="5. L√≥gica y Comparaciones">
          <option value="ej8">Comparaciones booleanas</option>
        </optgroup>
        <optgroup label="6. Anidaci√≥n">
          <option value="ej9">Estructuras anidadas</option>
        </optgroup>
      </select>
    </div>

    <div class="flex-row">
      <div class="editor-container">
        <h1 class="editor-title" data-es="C√≥digo fuente" data-nah="Tlahtoltecpantiliztli">C√≥digo fuente</h1>
        <form id="form">
          <div class="code-editor">
            <div class="line-numbers"></div>
            <textarea id="codigo" name="codigo" spellcheck="false" autocomplete="off"></textarea>
          </div>
          <div class="controls">
            <button type="submit" id="ejecutar-btn" data-es="‚ñ∂ Ejecutar" data-nah="‚ñ∂ Tictlaliz">‚ñ∂ Ejecutar</button>
            <label class="auto-run-label">
              <input type="checkbox" id="auto-ejecutar" checked />
              <span data-es="Auto-ejecutar" data-nah="Tlahtlaliz ahtle tictlatlania">Auto-ejecutar</span>
            </label>
          </div>
        </form>
      </div>

      <div class="salida-general">
        <div class="console-container">
          <div class="console-header">
            <span class="console-title" data-es="üì§ Salida General" data-nah="üì§ Tlalpanaliztli">üì§ Salida
              General</span>
            <span class="console-status success" id="console-status" data-es="Listo" data-nah="Tlami">Listo</span>
          </div>
          <div class="console-output" id="resultado">
            <div class="no-output" data-es="‚Äî Ejecuta el c√≥digo para ver los resultados ‚Äî"
              data-nah="‚Äî Xictlali tlahtolpehpenalistli iccampa tiquittaz ‚Äî">‚Äî Ejecuta el c√≥digo para ver los resultados
              ‚Äî</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal oculto por defecto -->
    <div id="diccionarioModal" class="modal" style="display: none;">
      <div class="modal-contenido">
        <span class="cerrar" onclick="cerrarModal()">&times;</span>
        <h2>Diccionario Tonayu</h2>

        <h3>Alfabeto y Caracteres Individuales</h3>
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Token</th>
              <th>Tipo</th>
              <th>Significado N√°huatl</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>1</td>
              <td>a</td>
              <td>Letra</td>
              <td>ƒÅtl (agua)</td>
            </tr>
            <tr>
              <td>2</td>
              <td>b</td>
              <td>Letra</td>
              <td>be (adaptado)</td>
            </tr>
            <tr>
              <td>3</td>
              <td>ch</td>
              <td>Letra</td>
              <td>chƒ´chƒ´ltik (rojo brillante)</td>
            </tr>
            <tr>
              <td>4</td>
              <td>e</td>
              <td>Letra</td>
              <td>ƒìhecatl (viento)</td>
            </tr>
            <tr>
              <td>5</td>
              <td>i</td>
              <td>Letra</td>
              <td>ƒ´ztli (obsidiana)</td>
            </tr>
            <tr>
              <td>6</td>
              <td>j</td>
              <td>Letra</td>
              <td>x≈çchitl (flor)</td>
            </tr>
            <tr>
              <td>7</td>
              <td>k</td>
              <td>Letra</td>
              <td>kalli (casa)</td>
            </tr>
            <tr>
              <td>8</td>
              <td>l</td>
              <td>Letra</td>
              <td>lolli (rodar)</td>
            </tr>
            <tr>
              <td>9</td>
              <td>m</td>
              <td>Letra</td>
              <td>metl (maguey)</td>
            </tr>
            <tr>
              <td>10</td>
              <td>n</td>
              <td>Letra</td>
              <td>nƒÅhui (cuatro)</td>
            </tr>
            <tr>
              <td>11</td>
              <td>o</td>
              <td>Letra</td>
              <td>≈çlli (hule)</td>
            </tr>
            <tr>
              <td>12</td>
              <td>p</td>
              <td>Letra</td>
              <td>pilli (noble)</td>
            </tr>
            <tr>
              <td>13</td>
              <td>q</td>
              <td>Letra</td>
              <td>quema (s√≠)</td>
            </tr>
            <tr>
              <td>14</td>
              <td>r</td>
              <td>Letra</td>
              <td>tepetl (cerro)</td>
            </tr>
            <tr>
              <td>15</td>
              <td>s</td>
              <td>Letra</td>
              <td>cuƒ´catl (canto)</td>
            </tr>
            <tr>
              <td>16</td>
              <td>t</td>
              <td>Letra</td>
              <td>tlƒÅcatl (persona)</td>
            </tr>
            <tr>
              <td>17</td>
              <td>u</td>
              <td>Letra</td>
              <td>uh (adaptado)</td>
            </tr>
            <tr>
              <td>18</td>
              <td>w</td>
              <td>Letra</td>
              <td>huƒìyi (grande)</td>
            </tr>
            <tr>
              <td>19</td>
              <td>x</td>
              <td>Letra</td>
              <td>xƒ´cotl (avispa)</td>
            </tr>
            <tr>
              <td>20</td>
              <td>y</td>
              <td>Letra</td>
              <td>y≈çllotl (coraz√≥n)</td>
            </tr>
            <tr>
              <td>21</td>
              <td>z</td>
              <td>Letra</td>
              <td>zacatl (pasto)</td>
            </tr>
            <tr>
              <td>22</td>
              <td>'</td>
              <td>Delimitador</td>
              <td>corte glotal</td>
            </tr>
          </tbody>
        </table>

        <h3>S√≠mbolos y Operadores</h3>
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Token</th>
              <th>Tipo</th>
              <th>Significado N√°huatl</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>100</td>
              <td>+</td>
              <td>Operador</td>
              <td>tlen mochƒ´hua (suma)</td>
            </tr>
            <tr>
              <td>101</td>
              <td>-</td>
              <td>Operador</td>
              <td>tlƒÅzotl (resta)</td>
            </tr>
            <tr>
              <td>102</td>
              <td>*</td>
              <td>Operador</td>
              <td>chƒ´chƒ´ltik yƒÅotl (multiplicaci√≥n)</td>
            </tr>
            <tr>
              <td>103</td>
              <td>/</td>
              <td>Operador</td>
              <td>nextep≈çllotl (divisi√≥n)</td>
            </tr>
            <tr>
              <td>104</td>
              <td>%</td>
              <td>Operador</td>
              <td>centƒìchƒ´uh (m√≥dulo)</td>
            </tr>
            <tr>
              <td>105</td>
              <td>=</td>
              <td>Operador</td>
              <td>tlen tlatskanƒ´ (asignaci√≥n)</td>
            </tr>
            <tr>
              <td>106</td>
              <td>==</td>
              <td>Operador</td>
              <td>tlatskanƒ´ t≈çkƒÅitl (igualdad)</td>
            </tr>
            <tr>
              <td>107</td>
              <td>!=</td>
              <td>Operador</td>
              <td>amochƒ´huanƒ´ (desigualdad)</td>
            </tr>
            <tr>
              <td>108</td>
              <td>
                << /td>
              <td>Operador</td>
              <td>tep≈çztli ichan (menor que)</td>
            </tr>
            <tr>
              <td>109</td>
              <td>></td>
              <td>Operador</td>
              <td>tep≈çztli ƒ´huƒÅn (mayor que)</td>
            </tr>
            <tr>
              <td>110</td>
              <td>
                <=< /td>
              <td>Operador</td>
              <td>tep≈çztli ichan o igual</td>
            </tr>
            <tr>
              <td>111</td>
              <td>>=</td>
              <td>Operador</td>
              <td>tep≈çztli ƒ´huƒÅn o igual</td>
            </tr>
          </tbody>
        </table>

        <h3>Delimitadores</h3>
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Token</th>
              <th>Tipo</th>
              <th>Significado N√°huatl</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>200</td>
              <td>(</td>
              <td>Delimitador</td>
              <td>nƒÅnakatl tlatskayotl (inicio)</td>
            </tr>
            <tr>
              <td>201</td>
              <td>)</td>
              <td>Delimitador</td>
              <td>nƒÅnakatl mopan≈ç (fin)</td>
            </tr>
            <tr>
              <td>202</td>
              <td>{</td>
              <td>Delimitador</td>
              <td>cuetlƒÅx≈çchitl tlatskayotl (inicio)</td>
            </tr>
            <tr>
              <td>203</td>
              <td>}</td>
              <td>Delimitador</td>
              <td>cuetlƒÅx≈çchitl mopan≈ç (fin)</td>
            </tr>
            <tr>
              <td>204</td>
              <td>[</td>
              <td>Delimitador</td>
              <td>cuapa (inicio lista)</td>
            </tr>
            <tr>
              <td>205</td>
              <td>]</td>
              <td>Delimitador</td>
              <td>cuapantli (fin lista)</td>
            </tr>
            <tr>
              <td>206</td>
              <td>,</td>
              <td>Delimitador</td>
              <td>cuƒ´tlal (separador)</td>
            </tr>
            <tr>
              <td>207</td>
              <td>;</td>
              <td>Delimitador</td>
              <td>tlatskayotl tlatskanƒ´ (fin l√≠nea)</td>
            </tr>
            <tr>
              <td>208</td>
              <td>:</td>
              <td>Delimitador</td>
              <td>tlatskayotl nechicoliztli (tipado)</td>
            </tr>
          </tbody>
        </table>

        <h3>Palabras Reservadas</h3>
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Token</th>
              <th>Tipo</th>
              <th>Significado N√°huatl</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>300</td>
              <td>chaj</td>
              <td>Keyword</td>
              <td>tlatskanƒ´</td>
            </tr>
            <tr>
              <td>301</td>
              <td>qex</td>
              <td>Keyword</td>
              <td>tlahcuiloa</td>
            </tr>
            <tr>
              <td>302</td>
              <td>toj</td>
              <td>Keyword</td>
              <td>zƒÅn</td>
            </tr>
            <tr>
              <td>303</td>
              <td>muk</td>
              <td>Keyword</td>
              <td>nechicoliztli huehcƒÅuh</td>
            </tr>
            <tr>
              <td>304</td>
              <td>b'ah</td>
              <td>Keyword</td>
              <td>calli tlatskayotl</td>
            </tr>
            <tr>
              <td>305</td>
              <td>nik</td>
              <td>Keyword</td>
              <td>mopan≈ç</td>
            </tr>
            <tr>
              <td>306</td>
              <td>pek'</td>
              <td>Keyword</td>
              <td>tƒìchpoua</td>
            </tr>
            <tr>
              <td>307</td>
              <td>chok</td>
              <td>Keyword</td>
              <td>huƒ´ca</td>
            </tr>
            <tr>
              <td>308</td>
              <td>utz'</td>
              <td>Keyword</td>
              <td>tƒìchmaca</td>
            </tr>
            <tr>
              <td>309</td>
              <td>naq</td>
              <td>Keyword</td>
              <td>tlachiyalistli</td>
            </tr>
            <tr>
              <td>310</td>
              <td>ja</td>
              <td>Literal</td>
              <td>quƒìmah</td>
            </tr>
            <tr>
              <td>311</td>
              <td>ma</td>
              <td>Literal</td>
              <td>ahmo quƒìmah</td>
            </tr>
            <tr>
              <td>312</td>
              <td>ahmo</td>
              <td>Literal</td>
              <td>ahmo cualcƒÅn</td>
            </tr>
          </tbody>
        </table>

        <h3>Tipos de Datos</h3>
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Token</th>
              <th>Tipo</th>
              <th>Significado N√°huatl</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>400</td>
              <td>loq</td>
              <td>Type</td>
              <td>tlahtolpantli</td>
            </tr>
            <tr>
              <td>401</td>
              <td>matlaktli</td>
              <td>Type</td>
              <td>tƒìntli</td>
            </tr>
            <tr>
              <td>402</td>
              <td>ompa</td>
              <td>Type</td>
              <td>nechicoliztli</td>
            </tr>
            <tr>
              <td>403</td>
              <td>tlƒÅzi</td>
              <td>Type</td>
              <td>caxt≈çlli</td>
            </tr>
            <tr>
              <td>404</td>
              <td>tlƒÅltikpak</td>
              <td>Type</td>
              <td>tecpanaliztli</td>
            </tr>
            <tr>
              <td>405</td>
              <td>cuixcoatli</td>
              <td>Type</td>
              <td>ƒÅmoxpouhka</td>
            </tr>
          </tbody>
        </table>


        <h3>Literales Num√©ricos</h3>
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Token</th>
              <th>Tipo</th>
              <th>Significado N√°huatl</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>500</td>
              <td>0</td>
              <td>Literal</td>
              <td>xochitzƒ´ntli (cero)</td>
            </tr>
            <tr>
              <td>501</td>
              <td>1</td>
              <td>Literal</td>
              <td>ce (uno)</td>
            </tr>
            <tr>
              <td>502</td>
              <td>2</td>
              <td>Literal</td>
              <td>≈çme (dos)</td>
            </tr>
            <tr>
              <td>503</td>
              <td>3</td>
              <td>Literal</td>
              <td>ƒìyi (tres)</td>
            </tr>
            <tr>
              <td>504</td>
              <td>4</td>
              <td>Literal</td>
              <td>nƒÅhui (cuatro)</td>
            </tr>
            <tr>
              <td>505</td>
              <td>5</td>
              <td>Literal</td>
              <td>mƒÅcuƒ´lli (cinco)</td>
            </tr>
            <tr>
              <td>506</td>
              <td>6</td>
              <td>Literal</td>
              <td>chicuƒìyi (seis)</td>
            </tr>
            <tr>
              <td>507</td>
              <td>7</td>
              <td>Literal</td>
              <td>chic≈çme (siete)</td>
            </tr>
            <tr>
              <td>508</td>
              <td>8</td>
              <td>Literal</td>
              <td>chicƒìyi (ocho)</td>
            </tr>
            <tr>
              <td>509</td>
              <td>9</td>
              <td>Literal</td>
              <td>chicnƒÅhui (nueve)</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>


    <section class="output-container" id="reportes">
      <div id="lexico"></div>
    </section>
  </main>

  <footer>
    <p data-es="&copy; 2025 Tonayu Project ‚Äî Inspirado en las lenguas originarias y el dise√±o moderno."
      data-nah="&copy; 2025 Tonayu Project ‚Äî Itechcopa tlahtolli tlachihualizhuan ihuan yancuic tlamachiliztli.">&copy;
      2025 Tonayu Project ‚Äî Inspirado en las lenguas originarias y el dise√±o moderno.</p>
  </footer>

  <script>
    const ejemplos = {
      ej1: `chaj x = 10;
chaj y = 2;
chaj z = (x + y) + 80;
qex z;
qex x + y;
qex x - y;
qex x * y;
qex x / y;
qex x % y;`,
      ej2: `pek' mochihua(g, b)
b'ah
  utz' g + b;
nik'

chaj x = 10;
chaj y = 5;
qex chok mochihua(x, y);`,
      ej3: `pek' niltoka()
b'ah
  qex "¬°Hola!";
nik'

chok niltoka();`,
      ej4: `pek' suma(a, b)
b'ah
  utz' a + b;
nik'

chaj total = chok suma(4, 5);
qex total;`,
      ej5: `chaj x = 10;
toj x > 3
b'ah
  qex "x es mayor que 3";
nik'`,
      ej6: `chaj edad = 17;

toj edad >= 18
b'ah
  qex "Eres mayor de edad";
nik'
amo ika
b'ah
  qex "Eres menor de edad";
nik'`,
      ej7: `chaj i = 0;

muk i < 5
b'ah
  qex i;
  chaj i = i + 1;
nik'`,
      ej8: `chaj a = 4;
chaj b = 7;
chaj c = a < b;
qex c;

chaj d = 10 == 10;
qex d;

chaj e = 5 > 3;
qex e;`,
      ej9: `pek' espar(n)
b'ah
  utz' n % 2 == 0;
nik'

toj chok espar(6)
b'ah
  qex "Es par";
nik'`
    };

    document.getElementById('ejemplos-btn').addEventListener('click', () => {
      const selector = document.getElementById('example-selector');
      selector.style.display = selector.style.display === 'none' ? 'block' : 'none';
    });

    document.getElementById('example-list').addEventListener('change', e => {
      const selected = e.target.value;
      document.getElementById('codigo').value = ejemplos[selected] || '';
    });

    document.getElementById('manual-btn').addEventListener('click', () => {
      window.open('manual.html', '_blank');
    });
  </script>


  <script>
    /* =====================================================
       MANEJO DE N√öMEROS DE L√çNEA Y ENV√çO DE C√ìDIGO
       ===================================================== */
    document.addEventListener('DOMContentLoaded', function () {
      // Elementos DOM principales.
      const textarea = document.getElementById('codigo');         // √Årea de c√≥digo fuente.
      const lineNumbers = document.querySelector('.line-numbers'); // Columna de n√∫meros de l√≠nea.

      /* -----------------------------------------------------
         Funci√≥n: updateLineNumbers
         Prop√≥sito: sincronizar la cantidad de l√≠neas que se
         muestran en la columna lateral con el texto actual.
      ----------------------------------------------------- */
      function updateLineNumbers() {
        const lineas = textarea.value.split('\n');                  // Divide por saltos de l√≠nea.
        lineNumbers.innerHTML = lineas.map((_, i) => (i + 1) + '<br>').join(''); // Genera HTML.
      }

      // Actualiza al cargar y cada vez que el usuario escriba.
      textarea.addEventListener('input', updateLineNumbers);
      updateLineNumbers();

      // ---------- ENV√çO MANUAL ----------
      document.getElementById('form').addEventListener('submit', function (e) {
        e.preventDefault();           // Evita recargar la p√°gina.
        ejecutarCodigo(false);        // Llama a la funci√≥n con modo normal.
      });

      /* =====================================================
         üîÑ MOD: AUTO-EJECUCI√ìN DIN√ÅMICA
         ===================================================== */

      /* -----------------------------------------------------
         Funci√≥n: debounce
         Prop√≥sito: esperar un tiempo (delay) despu√©s del
         √∫ltimo evento antes de ejecutar la funci√≥n "fn".
         Evita llamadas excesivas al servidor mientras el
         usuario escribe.
      ----------------------------------------------------- */
      const debounce = (fn, delay = 1000) => { // 1000 ms = 1 s.
        let temporizador;                      // Identificador del timeout.
        return (...args) => {                  // Devuelve funci√≥n wrapper.
          clearTimeout(temporizador);          // Reinicia el conteo.
          temporizador = setTimeout(() => fn(...args), delay); // Ejecuta tras delay.
        };
      };

      /* -----------------------------------------------------
         Funci√≥n: ejecutarCodigoDebounce
         Prop√≥sito: ejecutar el c√≥digo de forma silenciosa
         cuando el checkbox "Auto-ejecutar" est√© marcado.
      ----------------------------------------------------- */
      const ejecutarCodigoDebounce = debounce(() => {
        const autoEjecutar = document.getElementById('auto-ejecutar').checked; // Verifica checkbox.
        if (autoEjecutar) {
          ejecutarCodigo(true); // Llamada en modo silencioso.
        }
      });

      // Cada vez que se escribe algo, disparar debounce.
      textarea.addEventListener('input', ejecutarCodigoDebounce);

      /* =====================================================
         SELECTOR DE IDIOMA
         ===================================================== */
      const languageSelector = document.getElementById('language-selector');

      languageSelector.addEventListener('change', function () {
        const selectedLanguage = this.value;
        updateLanguage(selectedLanguage);
      });

      function updateLanguage(lang) {
        document.querySelectorAll('[data-es], [data-nah]').forEach(element => {
          if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA' || element.tagName === 'SELECT') {
            // No cambiar elementos de entrada
            return;
          }

          const text = element.getAttribute(`data-${lang}`);
          if (text) {
            if (element.hasAttribute('placeholder')) {
              element.setAttribute('placeholder', text);
            } else {
              element.textContent = text;
            }
          }
        });
      }
    });

    /* =====================================================
       Funci√≥n principal: ejecutarCodigo
       Par√°metros:
         silencioso ‚Üí true  = llamada autom√°tica
                      false = llamada manual (bot√≥n)
       ----------------------------------------------------- */
    async function ejecutarCodigo(silencioso = false) {
      const btn = document.getElementById('ejecutar-btn'); // Bot√≥n Ejecutar.
      const statusElement = document.getElementById('console-status');

      if (!silencioso) {                                   // S√≥lo en modo manual:
        btn.disabled = true;                               // Deshabilita bot√≥n.
        const currentLang = document.getElementById('language-selector').value;
        btn.textContent = currentLang === 'es' ? 'Procesando‚Ä¶' : 'Tictlaliztli‚Ä¶';
        statusElement.textContent = currentLang === 'es' ? 'Ejecutando...' : 'Tictlaliztli...';
        statusElement.className = 'console-status warning';
      }

      try {
        const codigo = document.getElementById('codigo').value; // Obtiene c√≥digo.

        // Env√≠a petici√≥n a PHP.
        const response = await fetch('ejecutar.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ codigo })
        });

        // Manejo de respuesta HTTP.
        if (!response.ok) {
          const error = await response.json().catch(() => null);
          throw new Error(error?.detalle || `Error ${response.status}`);
        }

        // Parseo de JSON resultante.
        const data = await response.json();
        if (data.error) throw new Error(data.error);

        mostrarResultados(data);  // Renderiza todo.
        const currentLang = document.getElementById('language-selector').value;
        statusElement.textContent = currentLang === 'es' ? '√âxito' : 'Tlami';
        statusElement.className = 'console-status success';

        if (!silencioso) document.getElementById('reportes').scrollIntoView({ behavior: 'smooth' });

      } catch (error) {
        console.error('Error completo:', error);
        const currentLang = document.getElementById('language-selector').value;
        statusElement.textContent = currentLang === 'es' ? 'Error' : 'Ahmo tlami';
        statusElement.className = 'console-status error';

        document.getElementById('resultado').innerHTML = `
          <div class="error-message">
            <div class="error-icon">‚ùå</div>
            <div>
              <h3>${currentLang === 'es' ? 'Error en la ejecuci√≥n' : 'Ahcoltiliztli ipan tictlaliztli'}</h3>
              <p>${escapeHtml(error.message)}</p>
              <small class="error-detail">${currentLang === 'es' ? 'Verifica la consola para detalles t√©cnicos' : 'Xiquitta consola iccampa tlamantli'}</small>
            </div>
          </div>`;
      } finally {
        if (!silencioso) {        // S√≥lo reactiva bot√≥n si era llamada manual.
          btn.disabled = false;
          const currentLang = document.getElementById('language-selector').value;
          btn.textContent = currentLang === 'es' ? '‚ñ∂ Ejecutar' : '‚ñ∂ Tictlaliz';
        }
      }
    }

    /* =====================================================
       Funci√≥n: mostrarResultados
       Prop√≥sito: pintar la salida del programa y
                  los errores (l√©xicos, sint√°cticos, sem√°nticos)
       ===================================================== */

    function mostrarResultados(data) {
      const divResultado = document.getElementById('resultado');
      let htmlSalida = '';
      const currentLang = document.getElementById('language-selector').value;

      if (data.error) {
        htmlSalida = `
      <div class="error-message">
        <div class="error-icon">‚ùå</div>
        <div>
          <h3>${currentLang === 'es' ? 'Error en la ejecuci√≥n' : 'Ahcoltiliztli ipan tictlaliztli'}</h3>
          <p>${escapeHtml(data.error)}</p>
        </div>
      </div>`;
      } else {
        const textoConsola = 'console_output' in data
          ? (data.console_output || `<span class="no-output">${currentLang === 'es' ? '(sin salida)' : '(ahmo tlalpanaliztli)'}</span>`)
          : `<span class="no-output">${currentLang === 'es' ? '(sin salida)' : '(ahmo tlalpanaliztli)'}</span>`;

        htmlSalida += `
      <div class="console-output-section">
        <h3>üíª ${currentLang === 'es' ? 'Salida del programa' : 'Tlalpanaliztli tlen programa'}</h3>
        <div class="output-content">${textoConsola.replace(/\n/g, '<br>')}</div>
      </div>`;

        // ‚úÖ Agregado: Derivaci√≥n del √°rbol sint√°ctico
        if (data.derivacion) {
          htmlSalida += `
        <div class="derivacion-section">
          <h3>üìò ${currentLang === 'es' ? 'Derivaci√≥n del programa' : 'Tlahtolpehpenalistli tlen tlahtolli'}</h3>
          <pre class="derivacion-block">${escapeHtml(data.derivacion)}</pre>
        </div>`;
        }

        /* ---------- Mostrar errores (si los hay) ---------- */
        const erroresLexicos = data.analisis?.lexico?.errores || [];
        const erroresSintacticos = data.analisis?.sintactico?.errores || [];
        const erroresSemanticos = data.analisis?.semantico?.errores || [];

        const totalErrores = erroresLexicos.length + erroresSintacticos.length + erroresSemanticos.length;

        if (totalErrores > 0) {
          htmlSalida += `
    <div class="error-section">
      <h3>‚ùå ${currentLang === 'es'
              ? `Errores de an√°lisis (${totalErrores})`
              : `Ahcoltiliztli ipan tlamachiliztli (${totalErrores})`}</h3>
      <div class="error-list">
        ${erroresLexicos.map(e => `
          <div class="error-line">
            <span class="error-icon">üü•</span>
            <span>
              <strong>${currentLang === 'es' ? `L√≠nea ${e.linea}:` : `Tlapalli ${e.linea}:`}</strong>
              [${currentLang === 'es' ? 'L√©xico' : 'Tlahtoltlamachiliztli'}] ${escapeHtml(e.mensaje)}
            </span>
          </div>`).join('')}

        ${erroresSintacticos.map(e => `
          <div class="error-line">
            <span class="error-icon">üüß</span>
            <span>
              <strong>${currentLang === 'es' ? `L√≠nea ${e.linea}:` : `Tlapalli ${e.linea}:`}</strong>
              [${currentLang === 'es' ? 'Sint√°ctico' : 'Tlahtolpehpenalistli'}] ${escapeHtml(e.mensaje)}
            </span>
          </div>`).join('')}

        ${erroresSemanticos.map(e => `
          <div class="error-line">
            <span class="error-icon">üü®</span>
            <span>
              <strong>${currentLang === 'es' ? `L√≠nea ${e.linea}:` : `Tlapalli ${e.linea}:`}</strong>
              [${currentLang === 'es' ? 'Sem√°ntico' : 'Tlamachiliztli'}] ${escapeHtml(e.mensaje)}
            </span>
          </div>`).join('')}
      </div>
    </div>`;
        } else {
          htmlSalida += `
    <div class="execution-status">
      <span class="success-icon">‚úì</span>
      <span>${currentLang === 'es'
              ? 'Ejecuci√≥n completada sin errores'
              : 'Tictlaliztli tlami ahmo ahcoltiliztli'}</span>
    </div>`;
        }

      }

      divResultado.innerHTML = htmlSalida;

      const divLexico = document.getElementById('lexico');
      if (data.analisis?.lexico) {
        const lex = data.analisis.lexico;
        divLexico.innerHTML = `
      <div class="analysis-section">
        <h2 class="section-title">üîç ${currentLang === 'es' ? 'An√°lisis L√©xico' : 'Tlahtoltlamachiliztli'}</h2>
        <div class="analysis-summary">
          <p><strong>${currentLang === 'es' ? 'Total tokens:' : 'Tlapohualiztli tokens:'}</strong> ${lex.total_tokens}</p>
          ${lex.errores.length
            ? `<p class="error-count"><strong>${currentLang === 'es' ? 'Errores:' : 'Ahcoltiliztli:'}</strong> ${lex.errores.length}</p>`
            : `<p class="success-message">‚úì ${currentLang === 'es' ? 'An√°lisis correcto' : 'Tlamachiliztli tlami'}</p>`}
        </div>
        ${generarTablaTokens(lex.tokens)}
        ${lex.errores.length ? generarListaErrores(lex.errores) : ''}
      </div>`;
      }

      function escapeHtml(str) {
        return str.replace(/[&<>"']/g, c => ({
          '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#039;'
        }[c]));
      }

      function generarTablaTokens(tokens) {
        return `
    <div class="table-container">
      <table class="token-table">
        <thead>
          <tr>
            <th>#</th>
            <th>Token</th>
            <th>${currentLang === 'es' ? 'Tipo' : 'Tlamantli'}</th>
            <th>${currentLang === 'es' ? 'L√≠nea' : 'Tlapalli'}</th>
            <th>${currentLang === 'es' ? 'Significado N√°huatl' : 'Tlahtolli n√°huatl'}</th>
          </tr>
        </thead>
        <tbody>
          ${tokens.map((t, i) => `
            <tr>
              <td>${i + 1}</td>
              <td><code>${escapeHtml(t.token)}</code></td>
              <td><span class="token-tag ${t.tipo ? t.tipo.toLowerCase() : ''}">${t.tipo || '‚Äî'}</span></td>              
              <td>${t.linea || '‚Äî'}</td>
              <td class="nahuatl">${t.nahuatl || '‚Äî'}</td>
            </tr>`).join('')}
        </tbody>
      </table>
    </div>`;
      }

      function generarListaErrores(errs) {
        return `
      <div class="error-details">
        <h3>${currentLang === 'es' ? 'Detalles de errores l√©xicos:' : 'Tlamantli ahcoltiliztli tlahtoltlamachiliztli:'}</h3>
        <ul class="error-list">
          ${errs.map(e => `
            <li>
              <strong>${currentLang === 'es' ? `L√≠nea ${e.linea}:` : `Tlapalli ${e.linea}:`}</strong> ${escapeHtml(e.mensaje)}
            </li>`).join('')}
        </ul>
      </div>`;
      }
    }

  </script>

  <script>
    document.getElementById("btnDiccionario").addEventListener("click", function () {
      const diccionario = document.getElementById("diccionario");
      diccionario.style.display = (diccionario.style.display === "none") ? "block" : "none";
    });
  </script>


  <script>
    document.getElementById("btnDiccionario").onclick = function () {
      document.getElementById("diccionarioModal").style.display = "flex";
    };

    function cerrarModal() {
      document.getElementById("diccionarioModal").style.display = "none";
    }

    // Cierra el modal si hacen clic fuera del contenido
    window.onclick = function (event) {
      const modal = document.getElementById("diccionarioModal");
      if (event.target === modal) {
        modal.style.display = "none";
      }
    };
  </script>


  <script>
    document.getElementById('language-selector').addEventListener('change', function () {
      const idioma = this.value;

      // Botones
      document.getElementById('ejemplos-btn').innerText = idioma === 'es' ? 'üìö Ejemplos' : 'üìö Tƒìixmatkƒì';
      document.getElementById('btnDiccionario').innerText = idioma === 'es' ? 'üìò Diccionario Tonayu' : 'üìò Tlaht≈çltla Tonayu';
      document.getElementById('manual-btn').innerText = idioma === 'es' ? 'üõ† Manual' : 'üõ† Tequipan';

      // Etiqueta del selector
      document.querySelector('label[for="example-list"]').innerText = idioma === 'es'
        ? 'Selecciona un ejemplo:'
        : 'Ma huelic in tƒìixmatkƒì:';

      // Opciones del selector de ejemplos
      const selector = document.getElementById('example-list');
      selector.innerHTML = idioma === 'es'
        ? `
      <option value="0">-- Elige una opci√≥n --</option>
      <optgroup label="1. Variables y Aritm√©tica">
        <option value="ej1">Declaraci√≥n y operaciones</option>
      </optgroup>
      <optgroup label="2. Funciones y llamadas">
        <option value="ej2">Funci√≥n sumar</option>
        <option value="ej3">Funci√≥n saludar</option>
        <option value="ej4">Funci√≥n con retorno</option>
      </optgroup>
      <optgroup label="3. Condicionales">
        <option value="ej5">Condicional simple</option>
        <option value="ej6">Condicional con else</option>
      </optgroup>
      <optgroup label="4. Ciclos">
        <option value="ej7">Ciclo while (muk)</option>
      </optgroup>
      <optgroup label="5. L√≥gica y Comparaciones">
        <option value="ej8">Comparaciones booleanas</option>
      </optgroup>
      <optgroup label="6. Anidaci√≥n">
        <option value="ej9">Estructuras anidadas</option>
      </optgroup>
    `
        : `
      <option value="0">-- Ma huelic --</option>
      <optgroup label="1. TlƒÅzohkamati ƒ´pan Variable ihuan Tlanƒìxtli">
        <option value="ej1">Tlatskanƒ´ ihuan TlƒÅzohkamati</option>
      </optgroup>
      <optgroup label="2. Tlaht≈çltin pek‚Äô ihuan chok">
        <option value="ej2">Tlaht≈çl pek‚Äô nemi tlen mochihua</option>
        <option value="ej3">Tlaht≈çl pek‚Äô nemi tlen niltokƒÅ</option>
        <option value="ej4">Tlaht≈çl pek‚Äô kualli utz‚Äô</option>
      </optgroup>
      <optgroup label="3. Toj tlen tlatskanƒ´">
        <option value="ej5">Toj tlatskanƒ´ kualli</option>
        <option value="ej6">Toj ihuan amo ika (else)</option>
      </optgroup>
      <optgroup label="4. Mƒìxiptla (Ciclos)">
        <option value="ej7">muk (bucle while/for)</option>
      </optgroup>
      <optgroup label="5. Nelli tlaht≈çltin">
        <option value="ej8">Tlanƒìxtli booleano</option>
      </optgroup>
      <optgroup label="6. Tlaht≈çlli chƒ´chƒ´ltik">
        <option value="ej9">Anidaci√≥n</option>
      </optgroup>
    `;
    });
  </script>




</body>

</html>